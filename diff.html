<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type"
          content="text/html; charset=UTF-8" />
    <title> %s (diff) </title>
    <!-- CSS is based upon the one used by Python's difflib.HtmlDiff.make_file() -->
    <style type="text/css">
        .head {
            font-family: monospace; /* good on macOS and Linux */
            font-size: 20px;
        }
        table.diff {
            font-family: monospace;
            font-size: 12px;
            border: medium;
        }
        .info-div {
            margin-top: 0.5em;
            margin-bottom: 0.5em;
        }
        .info-key {
            font-family: monospace;
            font-size: 12px;
            font-weight: bold;
        }
        .info-value {
            font-family: monospace;
            font-size: 12px;
        }
        .info-value-pre {
            font-family: monospace;
            font-size: 12px;
            margin-top: 0.2em;
        }
        a {
            color: #0000ee;
        }
        tbody tr:hover {
            background-color: #b7ebfc50;
        }
        /* colored like GitHub */
        span.diff_add, span.diff_chg, span.diff_sub { border-radius: 0.2em }
        .from_line {background-color:#ffeef0b7}
        [id^="from"] + td > span.diff_chg {background-color:#fdb8c0b7}
        [id^="from"] + td > span.diff_sub {background-color:#fdb8c0b7}
        .to_line {background-color:#e6ffedb7}
        [id^="to"] + td > span.diff_add {background-color:#acf2bdb7}
        [id^="to"] + td > span.diff_chg {background-color:#acf2bdb7}
        .diff_header { background-color:#e0e0e0 }
        td.diff_header {
            text-align:right;
            padding-right: 0.2ch;
        }
        .diff_next {background-color:#eeeeee}
    </style>
    <script>
        function actOnLoad() {
            populateFilename();
            insertTableHead();
            ensureNumAndTextColumnIsWide(3, 93);
            colorEntireLinesWhereDiffSpansExist();
        }
        function populateFilename() {
            const filename = location.href.split("/").slice(-1);
            document.getElementById("currentFilename").innerHTML = filename;
        }
        function insertTableHead() {
            const table = document.getElementsByTagName("table")[0];
            const header = table.createTHead();
            const header_row = header.insertRow(0);
            const cell_left = header_row.insertCell(-1);
            cell_left.colSpan="3";
            cell_left.style = "text-align:center;font-weight:bold";
            const anchor_left = document.createElement('a');
            anchor_left.innerHTML = "expected";
            anchor_left.href = document.getElementById("expected_file_url").href;
            anchor_left.title = document.getElementById("expected_file_url").innerText;
            cell_left.appendChild(anchor_left);
            const cell_right = header_row.insertCell(-1);
            cell_right.colSpan="3";
            cell_right.style = "text-align:center;font-weight:bold";
            const anchor_right = document.createElement('a');
            anchor_right.innerHTML = "actual";
            anchor_right.href = document.getElementById("actual_file_url").href;
            anchor_right.title = document.getElementById("actual_file_url").innerText;
            cell_right.appendChild(anchor_right);
        }
        function ensureNumAndTextColumnIsWide(num_width, text_width) {
            let line_number_tds = document.getElementsByClassName("diff_header");
            for (let line_num_node of line_number_tds) {
                line_num_node.style="width:" + num_width + "ch";
                const text_td_node = line_num_node.nextSibling;
                text_td_node.style="width:" + text_width + "ch";
            }
        }
        function colorEntireLinesWhereDiffSpansExist() {
            const spans_add = Array.from(document.getElementsByClassName("diff_add"));
            const spans_chg = Array.from(document.getElementsByClassName("diff_chg"));
            const spans_sub = Array.from(document.getElementsByClassName("diff_sub"));
            for (let span_node of spans_add.concat(spans_chg).concat(spans_sub)) {
                const parent = span_node.parentElement;        // td
                const parentPrevious = parent.previousSibling; // td
                if (parentPrevious.id.startsWith("from")) {
                    parent.classList.add("from_line");
                }
                if (parentPrevious.id.startsWith("to")) {
                    parent.classList.add("to_line");
                }
            }
        }
    </script>
</head>

<body onload="actOnLoad()">
    <h1 class="head">Diff</h1>
    <div class="info-div">
        <span class="info-key">this file</span><br>
        <span class="info-value">&nbsp;&nbsp;<span id="currentFilename"></span></span>
    </div>
    <div class="info-div">
        <span class="info-key">working environment</span><br>
        <span class="info-value">&nbsp;&nbsp;%s</span>
    </div>
    <div class="info-div">
        <span class="info-key">description</span><br>
        <span class="info-value">&nbsp;&nbsp;%s</span>
    </div>
    <div class="info-div">
        <span class="info-key">driver binary</span><br>
        <span class="info-value">&nbsp;&nbsp;%s</span>
    </div>
    <div class="info-div">
        <span class="info-key">invocation</span>
        <pre class="info-value-pre">%s</pre>
    </div>
    <div class="info-div">
        <span class="info-key">expected stdout (%s)</span><br> <!-- size string or "not found" -->
        <span class="info-value">&nbsp;&nbsp;<a href='%s' id="expected_file_url">%s</a></span>
    </div>
    <div class="info-div">
        <span class="info-key">actual stdout (%s)</span><br> <!-- size string -->
        <span class="info-value">&nbsp;&nbsp;<a href='%s' id="actual_file_url">%s</a></span>
    </div>

    <!-- table placeholder: Python's difflib.HtmlDiff.make_table() -->
    %s
</body>
</html>
